---
title: "Final Harvest"
author: "Eric R. Scott"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(targets)
library(car)
library(performance)
```

```{r load-targets, include=FALSE}
withr::with_dir(here::here(), {
  tar_load(c(kale_nutr))
})
```

# Effects of treatments and herbivory on biomass

I think this analysis only  makes sense for kale, if I remember correctly.  For beans, there's only data on the mass of beans, and for oats all the final harvest data is unreliable as the oats had already dehisced.

```{r}
kale <- 
  kale_nutr %>%
  select(
    current,
    historical,
    plot_id,
    pot_id,
    house,
    aug_ht,
    mass_above,
    mass_below,
    mass_total,
    jul_herbivory_mean,
    jul_herbivory,
    late_herbivory_mean,
    late_herbivory
  ) %>% 
  mutate(rs_ratio = mass_below / mass_above)
```

## Total biomass

```{r}
mass_lm <- lm(mass_total ~ current * historical + jul_herbivory + late_herbivory + house,
   data = kale)
# check_model(mass_lm)
Anova(mass_lm)
```

No effect of current treatment, historical treatment, their interaction, early or late herbivory, or house (blocking) on total biomass in august.

## Root:shoot ratio

```{r}
rs_lm <- lm(rs_ratio ~ current * historical + jul_herbivory + late_herbivory + house,
   data = kale)
# check_model(rs_lm)
Anova(rs_lm)
```

No effect of current treatment, historical treatment, their interaction, early or late herbivory, or house (blocking) on root:shoot ratio in august.


# Reproducibility

<details><summary>Reproducibility receipt</summary>

```{r}
## datetime
Sys.time()

## repository
if(requireNamespace('git2r', quietly = TRUE)) {
  git2r::repository()
} else {
  c(
    system2("git", args = c("log", "--name-status", "-1"), stdout = TRUE),
    system2("git", args = c("remote", "-v"), stdout = TRUE)
  )
}

## session info
sessionInfo()
```

</details>
